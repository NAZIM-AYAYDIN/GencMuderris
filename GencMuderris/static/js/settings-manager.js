// Ayarlar Y√∂neticisi
class SettingsManager {
  constructor() {
    this.settings = {
      theme: 'koyu',
      language: 'tr',
      nightMode: true,
      nightStart: '22:00',
      nightEnd: '07:00',
      disableAnimations: false,
      assistantSpeak: true,
      volumeLevel: 50,
      notificationSound: 'default',
      showNotifications: true,
      soundNotifications: true,
      emailNotifications: true,
      pushNotifications: true,
      
      // Ses ayarlarƒ±
      systemVolume: 70,
      notificationSound: 'default',
      notificationVolume: 50,
      ttsEngine: 'browser',
      ttsVoice: 'tr-TR-AhmetNeural',
      ttsSpeed: 1,
      ttsPitch: 1,
      assistantSpeak: true,
      autoReadMessages: false,
      audioQuality: 'medium',
      autoAudioBalance: true,
      audioLatency: 200,
      microphoneAccess: 'auto'
    };
    
    this.speechSynthesis = window.speechSynthesis;
    this.currentUtterance = null;
    
    this.nightModeTimer = null;
    this.init();
  }

  init() {
    this.loadSettings();
    this.bindEvents();
    this.applyTheme();
    this.applyAnimations();
    this.startNightModeMonitoring();
  }

  // Ayarlarƒ± y√ºkle
  loadSettings() {
    // Veritabanƒ±ndan kullanƒ±cƒ± ayarlarƒ±nƒ± y√ºkle
    // ≈ûimdilik localStorage kullanƒ±yoruz, sonra API ile deƒüi≈ütirilecek
    const savedSettings = localStorage.getItem('userSettings');
    if (savedSettings) {
      this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
    }
    
    this.updateFormElements();
  }

  // Form elemanlarƒ±nƒ± g√ºncelle
  updateFormElements() {
    // Tema se√ßimi
    const themeSelect = document.getElementById('themeSelect');
    if (themeSelect) {
      themeSelect.value = this.settings.theme;
    }

    // Dil se√ßimi
    const languageSelect = document.getElementById('languageSelect');
    if (languageSelect) {
      languageSelect.value = this.settings.language;
    }

    // Gece modu
    const nightMode = document.getElementById('nightMode');
    if (nightMode) {
      nightMode.checked = this.settings.nightMode;
    }

    // Gece modu saatleri
    const nightStart = document.getElementById('nightStart');
    if (nightStart) {
      nightStart.value = this.settings.nightStart;
    }

    const nightEnd = document.getElementById('nightEnd');
    if (nightEnd) {
      nightEnd.value = this.settings.nightEnd;
    }

    // Animasyonlar
    const disableAnimations = document.getElementById('disableAnimations');
    if (disableAnimations) {
      disableAnimations.checked = this.settings.disableAnimations;
    }

    // Asistan sesli konu≈üma
    const assistantSpeak = document.getElementById('assistantSpeak');
    if (assistantSpeak) {
      assistantSpeak.checked = this.settings.assistantSpeak;
    }

    // Sistem ses seviyesi (yeni)
    const systemVolume = document.getElementById('systemVolume');
    if (systemVolume) {
      systemVolume.value = this.settings.systemVolume;
    }

    // TTS hƒ±zƒ± (yeni)
    const ttsSpeed = document.getElementById('ttsSpeed');
    if (ttsSpeed) {
      ttsSpeed.value = this.settings.ttsSpeed;
    }

    // TTS motoru (yeni)
    const ttsEngine = document.getElementById('ttsEngine');
    if (ttsEngine) {
      ttsEngine.value = this.settings.ttsEngine;
    }

    // TTS ses (yeni)
    const ttsVoice = document.getElementById('ttsVoice');
    if (ttsVoice) {
      ttsVoice.value = this.settings.ttsVoice;
    }

    // Test metni (yeni)
    const testText = document.getElementById('testText');
    if (testText && !testText.value) {
      testText.value = 'Ho≈ügeldin Gen√ß M√ºderris';
    }

    // Bildirim sesi
    const notificationSound = document.getElementById('notificationSound');
    if (notificationSound) {
      notificationSound.value = this.settings.notificationSound;
    }

    // Bildirim ayarlarƒ±
    const showNotifications = document.getElementById('showNotifications');
    if (showNotifications) {
      showNotifications.checked = this.settings.showNotifications;
    }

    const soundNotifications = document.getElementById('soundNotifications');
    if (soundNotifications) {
      soundNotifications.checked = this.settings.soundNotifications;
    }

    const emailNotifications = document.getElementById('emailNotifications');
    if (emailNotifications) {
      emailNotifications.checked = this.settings.emailNotifications;
    }

    const pushNotifications = document.getElementById('pushNotifications');
    if (pushNotifications) {
      pushNotifications.checked = this.settings.pushNotifications;
    }

    // Gece modu durumuna g√∂re saat kutularƒ±nƒ± g√ºncelle
    this.updateNightModeTimeInputs();
  }

  // Gece modu izleme sistemini ba≈ülat
  startNightModeMonitoring() {
    if (this.settings.nightMode) {
      this.checkNightMode();
      // Her dakika kontrol et
      this.nightModeTimer = setInterval(() => {
        this.checkNightMode();
      }, 60000); // 60 saniye
    }
  }

  // Gece modu kontrol√º
  checkNightMode() {
    if (!this.settings.nightMode) return;

    const now = new Date();
    const currentTime = now.getHours() * 60 + now.getMinutes(); // Dakika cinsinden
    
    const startTime = this.timeToMinutes(this.settings.nightStart);
    const endTime = this.timeToMinutes(this.settings.nightEnd);
    
    let isNightTime = false;
    
    if (startTime <= endTime) {
      // Normal durum: 22:00 - 07:00
      isNightTime = currentTime >= startTime || currentTime <= endTime;
    } else {
      // Gece yarƒ±sƒ±nƒ± ge√ßen durum: 22:00 - 07:00
      isNightTime = currentTime >= startTime || currentTime <= endTime;
    }
    
    // Gece modu durumuna g√∂re tema uygula
    if (isNightTime) {
      this.applyNightMode();
    } else {
      this.applyDayMode();
    }
  }

  // Saat formatƒ±nƒ± dakikaya √ßevir
  timeToMinutes(timeString) {
    const [hours, minutes] = timeString.split(':').map(Number);
    return hours * 60 + minutes;
  }

  // Gece modu uygula - Standart gece temasƒ±
  applyNightMode() {
    const root = document.documentElement;
    const currentTheme = root.getAttribute('data-theme');
    
    // Eƒüer zaten gece modunda deƒüilse uygula
    if (currentTheme !== 'night-mode') {
      // Orijinal temayƒ± sakla
      root.setAttribute('data-original-theme', currentTheme);
      // Standart gece modunu uygula
      root.setAttribute('data-theme', 'night-mode');
      root.setAttribute('data-night-mode', 'true');
      
      // Gece modu bildirimi
      this.showNightModeNotification('üåô Gece modu aktif');
      
      console.log('üåô Gece modu aktif - Standart gece temasƒ± uygulandƒ±');
    }
  }

  // G√ºnd√ºz modu uygula - Orijinal temaya d√∂n
  applyDayMode() {
    const root = document.documentElement;
    const currentTheme = root.getAttribute('data-theme');
    
    // Eƒüer gece modundaysa orijinal temaya d√∂n
    if (currentTheme === 'night-mode') {
      const originalTheme = root.getAttribute('data-original-theme') || 'koyu';
      
      // Orijinal temaya geri d√∂n
      root.setAttribute('data-theme', originalTheme);
      root.removeAttribute('data-night-mode');
      root.removeAttribute('data-original-theme');
      
      // G√ºnd√ºz modu bildirimi
      this.showNightModeNotification('‚òÄÔ∏è G√ºnd√ºz modu aktif');
      
      console.log(`‚òÄÔ∏è G√ºnd√ºz modu aktif - ${originalTheme} temasƒ±na d√∂n√ºld√º`);
    }
  }

  // Gece modu bildirimi
  showNightModeNotification(message) {
    // K√º√ß√ºk bir bildirim g√∂ster
    const notification = document.createElement('div');
    notification.className = 'night-mode-notification';
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-sidebar);
      color: var(--text-main);
      padding: 10px 15px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      font-size: 0.8rem;
      z-index: 10000;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    `;
    
    document.body.appendChild(notification);
    
    // Animasyon
    setTimeout(() => {
      notification.style.opacity = '1';
      notification.style.transform = 'translateX(0)';
    }, 100);
    
    // 3 saniye sonra kaldƒ±r
    setTimeout(() => {
      notification.style.opacity = '0';
      notification.style.transform = 'translateX(100%)';
      setTimeout(() => {
        if (notification.parentNode) {
          document.body.removeChild(notification);
        }
      }, 300);
    }, 3000);
  }

  // Event listener'larƒ± baƒüla
  bindEvents() {
    // Tema deƒüi≈üimi
    const themeSelect = document.getElementById('themeSelect');
    if (themeSelect) {
      themeSelect.addEventListener('change', (e) => {
        this.settings.theme = e.target.value;
        this.applyTheme();
        this.saveSettings();
      });
    }

    // Gece modu
    const nightMode = document.getElementById('nightMode');
    if (nightMode) {
      nightMode.addEventListener('change', (e) => {
        this.settings.nightMode = e.target.checked;
        this.updateNightModeTimeInputs();
        
        if (this.settings.nightMode) {
          this.startNightModeMonitoring();
        } else {
          this.stopNightModeMonitoring();
          this.applyDayMode(); // Gece modunu kapat, orijinal temaya d√∂n
        }
        
        this.saveSettings();
      });
    }

    // Gece modu saatleri
    const nightStart = document.getElementById('nightStart');
    if (nightStart) {
      nightStart.addEventListener('change', (e) => {
        this.settings.nightStart = e.target.value;
        if (this.settings.nightMode) {
          this.checkNightMode(); // Hemen kontrol et
        }
        this.saveSettings();
      });
    }

    const nightEnd = document.getElementById('nightEnd');
    if (nightEnd) {
      nightEnd.addEventListener('change', (e) => {
        this.settings.nightEnd = e.target.value;
        if (this.settings.nightMode) {
          this.checkNightMode(); // Hemen kontrol et
        }
        this.saveSettings();
      });
    }

    // Animasyonlar
    const disableAnimations = document.getElementById('disableAnimations');
    if (disableAnimations) {
      disableAnimations.addEventListener('change', (e) => {
        this.settings.disableAnimations = e.target.checked;
        this.applyAnimations();
        this.saveSettings();
      });
    }

    // Asistan sesli konu≈üma
    const assistantSpeak = document.getElementById('assistantSpeak');
    if (assistantSpeak) {
      assistantSpeak.addEventListener('change', (e) => {
        this.settings.assistantSpeak = e.target.checked;
        this.saveSettings();
      });
    }

    // Ses seviyesi
    const volumeLevel = document.getElementById('volumeLevel');
    if (volumeLevel) {
      volumeLevel.addEventListener('input', (e) => {
        this.settings.volumeLevel = e.target.value;
        this.saveSettings();
      });
    }

    // Bildirim sesi
    const notificationSound = document.getElementById('notificationSound');
    if (notificationSound) {
      notificationSound.addEventListener('change', (e) => {
        this.settings.notificationSound = e.target.value;
        this.saveSettings();
      });
    }

    // Bildirim ayarlarƒ±
    const showNotifications = document.getElementById('showNotifications');
    if (showNotifications) {
      showNotifications.addEventListener('change', (e) => {
        this.settings.showNotifications = e.target.checked;
        this.saveSettings();
      });
    }

    const soundNotifications = document.getElementById('soundNotifications');
    if (soundNotifications) {
      soundNotifications.addEventListener('change', (e) => {
        this.settings.soundNotifications = e.target.checked;
        this.saveSettings();
      });
    }

    const emailNotifications = document.getElementById('emailNotifications');
    if (emailNotifications) {
      emailNotifications.addEventListener('change', (e) => {
        this.settings.emailNotifications = e.target.checked;
        this.saveSettings();
      });
    }

    const pushNotifications = document.getElementById('pushNotifications');
    if (pushNotifications) {
      pushNotifications.addEventListener('change', (e) => {
        this.settings.pushNotifications = e.target.checked;
        this.saveSettings();
      });
    }

    // Label'lara tƒ±klama olaylarƒ± ekle
    this.bindLabelEvents();

    // Ses ayarlarƒ±
    this.bindAudioEvents();

    // Oturum kapatma butonlarƒ±
    this.bindSessionEvents();
  }

  // Oturum kapatma event listener'larƒ±
  bindSessionEvents() {
    const closeSessionBtns = document.querySelectorAll('.close-session-btn');
    
    closeSessionBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        
        const sessionItem = btn.closest('.session-item');
        const sessionName = sessionItem.querySelector('span').textContent;
        
        if (confirm(`"${sessionName}" oturumunu kapatmak istediƒüinizden emin misiniz?`)) {
          // Oturum kapatma i≈ülemi
          sessionItem.style.opacity = '0.5';
          sessionItem.style.textDecoration = 'line-through';
          
          // 1 saniye sonra kaldƒ±r
          setTimeout(() => {
            sessionItem.remove();
          }, 1000);
          
          console.log(`Oturum kapatƒ±ldƒ±: ${sessionName}`);
        }
      });
    });
  }

  // Gece modu saat kutularƒ±nƒ± g√ºncelle
  updateNightModeTimeInputs() {
    const nightStart = document.getElementById('nightStart');
    const nightEnd = document.getElementById('nightEnd');
    const nightStartLabel = nightStart?.closest('.setting-item')?.querySelector('label');
    const nightEndLabel = nightEnd?.closest('.setting-item')?.querySelector('label');

    if (this.settings.nightMode) {
      // Gece modu aktif - saat kutularƒ±nƒ± aktif et
      if (nightStart) {
        nightStart.disabled = false;
        nightStart.style.opacity = '1';
        nightStart.style.cursor = 'pointer';
      }
      if (nightEnd) {
        nightEnd.disabled = false;
        nightEnd.style.opacity = '1';
        nightEnd.style.cursor = 'pointer';
      }
      
      // Label'larƒ± normal renk yap
      if (nightStartLabel) {
        nightStartLabel.style.color = 'var(--text-main)';
        nightStartLabel.style.cursor = 'pointer';
      }
      if (nightEndLabel) {
        nightEndLabel.style.color = 'var(--text-main)';
        nightEndLabel.style.cursor = 'pointer';
      }
    } else {
      // Gece modu pasif - saat kutularƒ±nƒ± pasif et
      if (nightStart) {
        nightStart.disabled = true;
        nightStart.style.opacity = '0.5';
        nightStart.style.cursor = 'not-allowed';
      }
      if (nightEnd) {
        nightEnd.disabled = true;
        nightEnd.style.opacity = '0.5';
        nightEnd.style.cursor = 'not-allowed';
      }
      
      // Label'larƒ± soluk renk yap
      if (nightStartLabel) {
        nightStartLabel.style.color = 'var(--text-muted)';
        nightStartLabel.style.cursor = 'not-allowed';
      }
      if (nightEndLabel) {
        nightEndLabel.style.color = 'var(--text-muted)';
        nightEndLabel.style.cursor = 'not-allowed';
      }
    }
  }

  // Label'lara tƒ±klama olaylarƒ±
  bindLabelEvents() {
    const settingItems = document.querySelectorAll('.setting-item');
    
    settingItems.forEach(item => {
      const label = item.querySelector('label');
      const input = item.querySelector('input, select');
      
      if (label && input) {
        label.addEventListener('click', () => {
          // Input disabled ise tƒ±klamayƒ± engelle
          if (input.disabled) {
            return;
          }
          
          // Input'a focus ver
          input.focus();
          
          // Checkbox ise toggle yap
          if (input.type === 'checkbox') {
            input.checked = !input.checked;
            input.dispatchEvent(new Event('change'));
          }
          
          // Select ise a√ß
          if (input.tagName === 'SELECT') {
            input.click();
          }
        });
      }
    });
  }

  // Temayƒ± uygula (normal tema deƒüi≈üimi)
  applyTheme() {
    const root = document.documentElement;
    const currentTheme = root.getAttribute('data-theme');
    
    // Eƒüer gece modu aktifse, tema deƒüi≈üimini engelle
    if (root.getAttribute('data-night-mode') === 'true') {
      console.log('Gece modu aktif - tema deƒüi≈üimi engellendi');
      return;
    }
    
    root.setAttribute('data-theme', this.settings.theme);
    
    // Tema deƒüi≈üikliƒüi animasyonu
    root.style.transition = 'all 0.3s ease';
    setTimeout(() => {
      root.style.transition = '';
    }, 300);
  }

  // Animasyonlarƒ± uygula
  applyAnimations() {
    const root = document.documentElement;
    if (this.settings.disableAnimations) {
      root.style.setProperty('--animation-duration', '0s');
      // T√ºm animasyonlarƒ± devre dƒ±≈üƒ± bƒ±rak
      document.body.style.setProperty('--transition-duration', '0s');
    } else {
      root.style.removeProperty('--animation-duration');
      document.body.style.removeProperty('--transition-duration');
    }
  }

  // Ayarlarƒ± kaydet
  saveSettings() {
    // ≈ûimdilik localStorage'a kaydet
    localStorage.setItem('userSettings', JSON.stringify(this.settings));
    
    // TODO: Veritabanƒ±na kaydet
    this.saveToDatabase();
  }

  // Veritabanƒ±na kaydet (API √ßaƒürƒ±sƒ±)
  async saveToDatabase() {
    try {
      // API endpoint'i hazƒ±r olduƒüunda buraya eklenecek
      // const response = await fetch('/api/settings', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify(this.settings)
      // });
      console.log('Ayarlar kaydedildi:', this.settings);
    } catch (error) {
      console.error('Ayarlar kaydedilirken hata:', error);
    }
  }

  // Gece modu izlemeyi durdur
  stopNightModeMonitoring() {
    if (this.nightModeTimer) {
      clearInterval(this.nightModeTimer);
      this.nightModeTimer = null;
    }
  }

  // Ses ayarlarƒ± event listener'larƒ±
  bindAudioEvents() {
    // Sistem ses seviyesi
    const systemVolume = document.getElementById('systemVolume');
    if (systemVolume) {
      systemVolume.addEventListener('input', (e) => {
        // 1-100 arasƒ±nda sƒ±nƒ±rla
        let value = parseInt(e.target.value);
        if (value < 1) value = 1;
        if (value > 100) value = 100;
        
        this.settings.systemVolume = value;
        e.target.value = value;
        this.saveSettings();
      });
    }

    // TTS hƒ±zƒ±
    const ttsSpeed = document.getElementById('ttsSpeed');
    if (ttsSpeed) {
      ttsSpeed.addEventListener('input', (e) => {
        // 0.5-2 arasƒ±nda sƒ±nƒ±rla
        let value = parseFloat(e.target.value);
        if (value < 0.5) value = 0.5;
        if (value > 2) value = 2;
        
        this.settings.ttsSpeed = value;
        e.target.value = value;
        this.saveSettings();
      });
    }

    // Test butonu
    const testTTS = document.getElementById('testTTS');
    const testText = document.getElementById('testText');

    if (testTTS && testText) {
      testTTS.addEventListener('click', () => {
        if (testTTS.classList.contains('playing')) {
          // Durdur
          this.stopTTS();
          testTTS.classList.remove('playing');
          testTTS.innerHTML = '<i class="fa-solid fa-play"></i>';
        } else {
          // Ba≈ülat
          this.testTTS(testText.value);
          testTTS.classList.add('playing');
          testTTS.innerHTML = '<i class="fa-solid fa-stop"></i>';
        }
      });
    }

    // Diƒüer ses ayarlarƒ±
    const ttsEngine = document.getElementById('ttsEngine');
    if (ttsEngine) {
      ttsEngine.addEventListener('change', (e) => {
        this.settings.ttsEngine = e.target.value;
        this.saveSettings();
      });
    }

    const ttsVoice = document.getElementById('ttsVoice');
    if (ttsVoice) {
      ttsVoice.addEventListener('change', (e) => {
        this.settings.ttsVoice = e.target.value;
        this.saveSettings();
      });
    }

    const notificationSound = document.getElementById('notificationSound');
    if (notificationSound) {
      notificationSound.addEventListener('change', (e) => {
        this.settings.notificationSound = e.target.value;
        this.saveSettings();
      });
    }
  }

  // TTS test fonksiyonu
  testTTS(text) {
    if (!this.speechSynthesis) {
      alert('Tarayƒ±cƒ±nƒ±z sesli okuma √∂zelliƒüini desteklemiyor.');
      return;
    }

    // Mevcut konu≈ümayƒ± durdur
    this.stopTTS();

    // Yeni utterance olu≈ütur
    this.currentUtterance = new SpeechSynthesisUtterance(text);
    
    // Ayarlarƒ± uygula
    this.currentUtterance.rate = this.settings.ttsSpeed;
    this.currentUtterance.pitch = this.settings.ttsPitch;
    this.currentUtterance.volume = this.settings.systemVolume / 100;
    
    // Ses se√ßimi (basit implementasyon)
    const voices = this.speechSynthesis.getVoices();
    const selectedVoice = voices.find(voice => voice.lang === 'tr-TR') || voices[0];
    if (selectedVoice) {
      this.currentUtterance.voice = selectedVoice;
    }

    // Event listener'lar
    this.currentUtterance.onend = () => {
      const testTTS = document.getElementById('testTTS');
      if (testTTS) {
        testTTS.classList.remove('playing');
        testTTS.innerHTML = '<i class="fa-solid fa-play"></i>';
      }
    };

    this.currentUtterance.onerror = (event) => {
      console.error('TTS Hatasƒ±:', event);
      alert('Sesli okuma sƒ±rasƒ±nda hata olu≈ütu.');
      const testTTS = document.getElementById('testTTS');
      if (testTTS) {
        testTTS.classList.remove('playing');
        testTTS.innerHTML = '<i class="fa-solid fa-play"></i>';
      }
    };

    // Konu≈ümayƒ± ba≈ülat
    this.speechSynthesis.speak(this.currentUtterance);
  }

  // TTS durdurma
  stopTTS() {
    if (this.speechSynthesis) {
      this.speechSynthesis.cancel();
    }
    this.currentUtterance = null;
  }
}

// Veri Y√∂netimi Ayarlarƒ± Y√∂neticisi
class DataManagementSettings {
  constructor() {
    this.settings = {
      dataAnalytics: false,
      deviceInfoSharing: false,
      usageStats: false,
      errorReporting: false,
      autoBackup: false
    };
    
    this.init();
  }
  
  init() {
    this.loadSettings();
    this.bindEvents();
    this.applySettings();
  }
  
  // Ayarlarƒ± localStorage'dan y√ºkle
  loadSettings() {
    const savedSettings = localStorage.getItem('dataManagementSettings');
    if (savedSettings) {
      this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
    }
    
    // Checkbox'larƒ± ayarla
    Object.keys(this.settings).forEach(key => {
      const checkbox = document.getElementById(key);
      if (checkbox) {
        checkbox.checked = this.settings[key];
      }
    });
  }
  
  // Event listener'larƒ± baƒüla
  bindEvents() {
    const checkboxes = [
      'dataAnalytics',
      'deviceInfoSharing', 
      'usageStats',
      'errorReporting',
      'autoBackup'
    ];
    
    checkboxes.forEach(id => {
      const checkbox = document.getElementById(id);
      if (checkbox) {
        checkbox.addEventListener('change', (e) => {
          this.settings[id] = e.target.checked;
          this.saveSettings();
          this.applySettings();
          this.showNotification(id, e.target.checked);
        });
      }
    });
  }
  
  // Ayarlarƒ± localStorage'a kaydet
  saveSettings() {
    localStorage.setItem('dataManagementSettings', JSON.stringify(this.settings));
    
    // Gelecekte veritabanƒ±na kaydetme i√ßin hazƒ±rlƒ±k
    this.prepareForDatabase();
  }
  
  // Veritabanƒ±na kaydetme i√ßin hazƒ±rlƒ±k (gelecekte kullanƒ±lacak)
  prepareForDatabase() {
    const settingsForDB = {
      userId: this.getCurrentUserId(), // Gelecekte eklenecek
      settings: this.settings,
      timestamp: new Date().toISOString(),
      userType: this.getUserType() // 'parent' veya 'child'
    };
    
    // ≈ûimdilik console'a yazdƒ±r, gelecekte API'ye g√∂nder
    console.log('Veritabanƒ±na kaydedilecek ayarlar:', settingsForDB);
  }
  
  // Ayarlarƒ± uygula
  applySettings() {
    if (this.settings.dataAnalytics) {
      this.enableDataAnalytics();
    } else {
      this.disableDataAnalytics();
    }
    
    if (this.settings.deviceInfoSharing) {
      this.enableDeviceInfoSharing();
    } else {
      this.disableDeviceInfoSharing();
    }
    
    if (this.settings.usageStats) {
      this.enableUsageStats();
    } else {
      this.disableUsageStats();
    }
    
    if (this.settings.errorReporting) {
      this.enableErrorReporting();
    } else {
      this.disableErrorReporting();
    }
    
    if (this.settings.autoBackup) {
      this.enableAutoBackup();
    } else {
      this.disableAutoBackup();
    }
  }
  
  // Bildirim g√∂ster
  showNotification(settingName, enabled) {
    const settingLabels = {
      dataAnalytics: 'Veri Analizi ve ƒ∞yile≈ütirme',
      deviceInfoSharing: 'Cihaz Bilgilerini Payla≈ü',
      usageStats: 'Kullanƒ±m ƒ∞statistikleri',
      errorReporting: 'Hata Raporlama',
      autoBackup: 'Otomatik Yedekleme'
    };
    
    const status = enabled ? 'etkinle≈ütirildi' : 'devre dƒ±≈üƒ± bƒ±rakƒ±ldƒ±';
    const message = `${settingLabels[settingName]} ${status}`;
    
    // Basit bildirim (gelecekte daha geli≈ümi≈ü olabilir)
    console.log(message);
    
    // Toast notification eklenebilir
    this.showToast(message, enabled ? 'success' : 'info');
  }
  
  // Toast notification (basit versiyon)
  showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast-notification ${type}`;
    toast.textContent = message;
    toast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'success' ? '#4caf50' : '#2196f3'};
      color: white;
      padding: 12px 20px;
      border-radius: 4px;
      z-index: 10000;
      font-size: 0.85rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => {
        document.body.removeChild(toast);
      }, 300);
    }, 3000);
  }
  
  // Gelecekte eklenecek metodlar
  getCurrentUserId() {
    // Kullanƒ±cƒ± ID'sini d√∂nd√ºr (gelecekte eklenecek)
    return 'user_' + Date.now();
  }
  
  getUserType() {
    // Kullanƒ±cƒ± tipini d√∂nd√ºr (gelecekte eklenecek)
    return 'parent'; // veya 'child'
  }
  
  // √ñzellik etkinle≈ütirme/devre dƒ±≈üƒ± bƒ±rakma metodlarƒ±
  enableDataAnalytics() {
    console.log('Veri analizi etkinle≈ütirildi');
    // Analytics kodlarƒ± buraya eklenecek
  }
  
  disableDataAnalytics() {
    console.log('Veri analizi devre dƒ±≈üƒ± bƒ±rakƒ±ldƒ±');
    // Analytics kodlarƒ± buradan kaldƒ±rƒ±lacak
  }
  
  enableDeviceInfoSharing() {
    console.log('Cihaz bilgisi payla≈üƒ±mƒ± etkinle≈ütirildi');
    // Cihaz bilgisi toplama kodlarƒ±
  }
  
  disableDeviceInfoSharing() {
    console.log('Cihaz bilgisi payla≈üƒ±mƒ± devre dƒ±≈üƒ± bƒ±rakƒ±ldƒ±');
    // Cihaz bilgisi toplama kodlarƒ± kaldƒ±rƒ±lacak
  }
  
  enableUsageStats() {
    console.log('Kullanƒ±m istatistikleri etkinle≈ütirildi');
    // Kullanƒ±m takibi kodlarƒ±
  }
  
  disableUsageStats() {
    console.log('Kullanƒ±m istatistikleri devre dƒ±≈üƒ± bƒ±rakƒ±ldƒ±');
    // Kullanƒ±m takibi kodlarƒ± kaldƒ±rƒ±lacak
  }
  
  enableErrorReporting() {
    console.log('Hata raporlama etkinle≈ütirildi');
    // Hata yakalama kodlarƒ±
  }
  
  disableErrorReporting() {
    console.log('Hata raporlama devre dƒ±≈üƒ± bƒ±rakƒ±ldƒ±');
    // Hata yakalama kodlarƒ± kaldƒ±rƒ±lacak
  }
  
  enableAutoBackup() {
    console.log('Otomatik yedekleme etkinle≈ütirildi');
    // Yedekleme kodlarƒ±
  }
  
  disableAutoBackup() {
    console.log('Otomatik yedekleme devre dƒ±≈üƒ± bƒ±rakƒ±ldƒ±');
    // Yedekleme kodlarƒ± kaldƒ±rƒ±lacak
  }
}

// CSS Animasyonlarƒ±
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
`;
document.head.appendChild(style);

// Sayfa y√ºklendiƒüinde ba≈ülat
document.addEventListener('DOMContentLoaded', function() {
  window.settingsManager = new SettingsManager();
  window.dataManagementSettings = new DataManagementSettings();
}); 

// ƒ∞leti≈üim formu g√∂nderimi
document.addEventListener('DOMContentLoaded', function() {
  const iletisimForm = document.getElementById('iletisimForm');
  const successMessage = document.getElementById('iletisimSuccess');
  
  if (iletisimForm) {
    iletisimForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Form verilerini al
      const formData = new FormData(this);
      
      // Burada form verilerini sunucuya g√∂nderebilirsiniz
      // √ñrnek: fetch('/iletisim-gonder', { method: 'POST', body: formData })
      
      // Ba≈üarƒ± mesajƒ±nƒ± g√∂ster
      successMessage.style.display = 'block';
      
      // Formu temizle
      this.reset();
      
      // 3 saniye sonra ba≈üarƒ± mesajƒ±nƒ± gizle
      setTimeout(function() {
        successMessage.style.display = 'none';
      }, 3000);
    });
  }
}); 

// Dosya ekleme butonu i≈ülevi
document.addEventListener('DOMContentLoaded', function() {
  const dosyaEkleBtn = document.getElementById('dosyaEkleBtn');
  const dosyaInput = document.getElementById('dosya');
  const dosyaAdi = document.getElementById('dosyaAdi');
  
  if (dosyaEkleBtn && dosyaInput) {
    dosyaEkleBtn.addEventListener('click', function() {
      dosyaInput.click();
    });
    
    dosyaInput.addEventListener('change', function() {
      if (this.files.length > 0) {
        dosyaAdi.textContent = 'Se√ßilen dosya: ' + this.files[0].name;
        dosyaAdi.style.color = '#28a745';
      } else {
        dosyaAdi.textContent = '';
      }
    });
  }
}); 

// KULLANICILAR SEKMESƒ∞ FONKSƒ∞YONLARI
document.addEventListener('DOMContentLoaded', function() {
  // Kullanƒ±cƒ±lar sekmesi butonlarƒ±na event listener ekle
  const kullaniciButtons = document.querySelectorAll('#kullanƒ±cƒ±lar-content .sidebar-menu-btn');
  
  kullaniciButtons.forEach(button => {
    button.addEventListener('click', function() {
      const subsection = this.getAttribute('data-subsection');
      showKullaniciSubsection(subsection);
    });
  });
  
  // Otomatik profil a√ßma i≈ülemini tamamen kaldƒ±r
  // showKullaniciSubsection('profil');
});

// Alt sekme g√∂sterme fonksiyonu - G√úNCELLENMƒ∞≈û
function showKullaniciSubsection(subsectionId) {
  console.log('Alt sekme g√∂steriliyor:', subsectionId);
  
  // Sadece kullanƒ±cƒ±lar sekmesi i√ßindeki butonlarƒ± ve i√ßerikleri i≈üle
  const kullanicilarContent = document.getElementById('kullanƒ±cƒ±lar-content');
  if (!kullanicilarContent) {
    console.log('Kullanƒ±cƒ±lar sekmesi bulunamadƒ±');
    return;
  }
  
  // T√ºm butonlardan active class'ƒ±nƒ± kaldƒ±r
  const buttons = kullanicilarContent.querySelectorAll('.sidebar-menu-btn');
  buttons.forEach(btn => btn.classList.remove('active'));
  
  // T√úM ALT MEN√ú ƒ∞√áERƒ∞KLERƒ∞Nƒ∞ Gƒ∞ZLE
  const allSubsections = document.querySelectorAll('.subsection-content');
  allSubsections.forEach(content => {
    content.classList.remove('active');
    content.classList.add('hidden');
  });
  
  // Se√ßilen butona active class'ƒ± ekle
  const activeButton = kullanicilarContent.querySelector(`[data-subsection="${subsectionId}"]`);
  if (activeButton) {
    activeButton.classList.add('active');
  }
  
  // Se√ßilen i√ßeriƒüi g√∂ster
  const activeContent = kullanicilarContent.querySelector(`#${subsectionId}-content`);
  if (activeContent) {
    activeContent.classList.remove('hidden');
    activeContent.classList.add('active');
    
    console.log('Alt sekme g√∂sterildi:', subsectionId);
    
    // Profil sekmesi ise kullanƒ±cƒ± bilgilerini y√ºkle
    if (subsectionId === 'profil') {
      loadUserProfile();
    }
    
  } else {
    console.error('Alt sekme i√ßeriƒüi bulunamadƒ±:', subsectionId);
  }
}

// PROFƒ∞L G√úNCELLEME FONKSƒ∞YONU - G√úNCELLENMƒ∞≈û
async function updateProfile(event) {
  event.preventDefault();
  
  const form = event.target;
  const formData = new FormData(form);
  const messageDiv = document.getElementById('profileMessage');
  
  try {
    // Loading g√∂ster
    messageDiv.style.display = 'block';
    messageDiv.className = 'message-box loading';
    messageDiv.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> G√ºncelleniyor...';
    
    // API'ye g√∂nder
    const response = await fetch('/api/settings/update-profile', {
      method: 'POST',
      body: formData
    });
    
    const result = await response.json();
    
    if (response.ok) {
      // Ba≈üarƒ±
      messageDiv.className = 'message-box success';
      messageDiv.innerHTML = '<i class="fa-solid fa-check"></i> ' + (result.message || 'Profil ba≈üarƒ±yla g√ºncellendi');
      
      // Form verilerini g√ºncelle
      if (result.user) {
        document.getElementById('firstName').value = result.user.first_name || '';
        document.getElementById('lastName').value = result.user.last_name || '';
        document.getElementById('email').value = result.user.email || '';
        document.getElementById('phone').value = result.user.phone || '';
        document.getElementById('birthDate').value = result.user.birth_date || '';
      }
    } else {
      // Hata
      messageDiv.className = 'message-box error';
      messageDiv.innerHTML = '<i class="fa-solid fa-exclamation-triangle"></i> ' + (result.detail || 'G√ºncelleme ba≈üarƒ±sƒ±z');
    }
    
  } catch (error) {
    console.error('Profil g√ºncelleme hatasƒ±:', error);
    messageDiv.className = 'message-box error';
    messageDiv.innerHTML = '<i class="fa-solid fa-exclamation-triangle"></i> Baƒülantƒ± hatasƒ±';
  }
  
  // 3 saniye sonra mesajƒ± gizle
  setTimeout(() => {
    messageDiv.style.display = 'none';
  }, 3000);
}

// Kullanƒ±cƒ± profil bilgilerini y√ºkle
async function loadUserProfile() {
  // Sadece kullanƒ±cƒ±lar sekmesi aktifken √ßalƒ±≈üsƒ±n
  const kullanicilarContent = document.getElementById('kullanƒ±cƒ±lar-content');
  const isKullanicilarActive = kullanicilarContent && !kullanicilarContent.classList.contains('hidden');
  
  if (!isKullanicilarActive) {
    console.log('loadUserProfile sadece kullanƒ±cƒ±lar sekmesinde √ßalƒ±≈üabilir');
    return;
  }
  
  try {
    const response = await fetch('/api/settings/api/user-profile');
    const userData = await response.json();
    
    if (response.ok && userData.data) {
      const user = userData.data;
      document.getElementById('firstName').value = user.first_name || '';
      document.getElementById('lastName').value = user.last_name || '';
      document.getElementById('email').value = user.email || '';
      document.getElementById('phone').value = user.phone || '';
      document.getElementById('birthDate').value = user.birth_date || '';
    }
  } catch (error) {
    console.error('Kullanƒ±cƒ± bilgileri y√ºklenirken hata:', error);
  }
}

// AYARLAR SEKMELERƒ∞ ƒ∞√áƒ∞N D√úZELTME - EN SONA EKLE
document.addEventListener('DOMContentLoaded', function() {
  // Ayarlar sekmesi butonlarƒ±na event listener ekle
  const ayarlarButtons = document.querySelectorAll('#ayarlar-content .sidebar-menu-btn');
  
  ayarlarButtons.forEach(button => {
    button.addEventListener('click', function() {
      const subsection = this.getAttribute('data-subsection');
      showAyarlarSubsection(subsection);
    });
  });
});

// Ayarlar alt sekme g√∂sterme fonksiyonu
function showAyarlarSubsection(subsectionId) {
  console.log('Ayarlar alt sekme g√∂steriliyor:', subsectionId);
  
  // Sadece ayarlar sekmesi i√ßindeki butonlarƒ± ve i√ßerikleri i≈üle
  const ayarlarContent = document.getElementById('ayarlar-content');
  if (!ayarlarContent) {
    console.log('Ayarlar sekmesi bulunamadƒ±');
    return;
  }
  
  // T√ºm butonlardan active class'ƒ±nƒ± kaldƒ±r
  const buttons = ayarlarContent.querySelectorAll('.sidebar-menu-btn');
  buttons.forEach(btn => btn.classList.remove('active'));
  
  // T√úM ALT MEN√ú ƒ∞√áERƒ∞KLERƒ∞Nƒ∞ Gƒ∞ZLE
  const allSubsections = ayarlarContent.querySelectorAll('.subsection-content');
  allSubsections.forEach(content => {
    content.classList.remove('active');
    content.classList.add('hidden');
  });
  
  // Se√ßilen butona active class'ƒ± ekle
  const activeButton = ayarlarContent.querySelector(`[data-subsection="${subsectionId}"]`);
  if (activeButton) {
    activeButton.classList.add('active');
  }
  
  // Se√ßilen i√ßeriƒüi g√∂ster
  const activeContent = ayarlarContent.querySelector(`#${subsectionId}-content`);
  if (activeContent) {
    activeContent.classList.remove('hidden');
    activeContent.classList.add('active');
    
    console.log('Ayarlar alt sekme g√∂sterildi:', subsectionId);
  } else {
    console.error('Ayarlar alt sekme i√ßeriƒüi bulunamadƒ±:', subsectionId);
  }
} 